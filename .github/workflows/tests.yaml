name: Tests

on: push

jobs:
  test:
    runs-on: ubuntu-latest
    name: Tests

    steps:
      - uses: actions/checkout@v3

      - id: common
        uses: ghga-de/gh-action-common@v3

      - name: Run pytest
        run: |
          SITE_PACKAGE_DIR="$(pip show ${{steps.common.outputs.MAIN_SRC_DIR}} | grep Location: |  sed "s/^Location: //")"
          SOURCE_DIR=${${SITE_PACKAGE_DIR}/${{steps.common.outputs.MAIN_SRC_DIR}}}
          pytest \
            --cov="${SOURCE_DIR}" \
            tests

      # - id: coveralls
      #   name: Upload coverage to coveralls
      #   env:
      #     GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      #   run: |
      #     pip install --upgrade coveralls
      #     coveralls --service=github
